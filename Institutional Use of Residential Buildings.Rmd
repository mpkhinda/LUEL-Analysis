---
title: "Institutional Use of Residential Buildings"
author: "Matt Khinda"
date: "10/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r libraries, include = FALSE}
library(sf)
library(ggspatial)
library(tidyverse)
library(here)
library(ggthemes)
```

```{r load data}
all_parcels <- read_sf(here("Data", "ASSESSING_ParcelsFY2022.shp"))

badML = c("-", "--", "---", "--MD", "--R", "--R1", "--RR", "--S11")

#remove unassigned parcels
all_parcels <- all_parcels %>%
  filter(!(ML %in% badML))

assessors_data <- read_csv(here("Data", "Cambridge_Property_Database_FY2021.csv"))

overlays <- read_sf(here("Data", "CDD_ZoningOverlayDistricts.shp"))

institutional_overlays <- overlays %>%
  filter(Type == "Institutional")

#join datasets by map-lot
parcel_data <- merge(x = all_parcels, y = assessors_data, by.x = "ML", by.y = "Map/Lot")
```

```{r institutional lots}
#filter using state class codes (starting with 9 is institutional use)
institutional_lots <- parcel_data %>%
  filter(substr(StateClassCode, 1, 1) == 9)

#remove unnecessary property classes
badPropClass = c("US Government", "DCR- State Parks and Rec", "Vacant City", "Vacant Local Education", "Improved City", "Vacant, Tax Title", "Vacant (Private Ed)", "Housing, Other", "Housing Authority", "Other Open Space", "Transportation Authority", "Utility Authority", "Vacnt Transport Authorit", "Vacant Utility Authority", "Improved Public Safety", "Imprvd County Admin", "121 Corporation", "Cemeteries")

institutional_lots <- institutional_lots %>%
  filter(!(PropertyClass %in% badPropClass))


#filter for residential exterior styles
unique(institutional_lots$Exterior_Style)

goodExteriorStyles = c("APARTMENTS", "APTS-LUXURY", "CAPE-COD", "COLONIAL", "DECKER", "DUPLEX", "MULT-RESDNCE", "VICTORIAN")

institutional_residential_lots <- institutional_lots %>%
  filter(Exterior_Style %in% goodExteriorStyles | Exterior_occupancy == "SNGL-FAM-RES")


```

```{r plot, echo=FALSE}
ggplot()+
  annotation_map_tile(zoomin = 0, progress = "none", type = "cartolight")+
  geom_sf(data = institutional_residential_lots, aes(fill = PropertyClass), color = NA)+
  geom_sf(data = institutional_overlays, fill = NA, linetype = "dashed") +
  scale_fill_solarized() +
  theme_void()
```

